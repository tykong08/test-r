# 시선 보정 UI 가이드

## ✨ 새로운 기능: 시선 보정 중 웹캠 프리뷰

시선 보정을 시작하면 **화면 오른쪽 하단**에 실시간 웹캠 영상이 표시됩니다.

### 📹 웹캠 프리뷰 위치

```
┌──────────────────────────────────────┐
│                                      │
│     시선 보정 화면                    │
│                                      │
│         🔴 (빨간 점)                 │
│                                      │
│                                      │
│                    ┌─────────────┐  │
│                    │  웹캠 영상   │  │
│                    │             │  │
│                    │  ✓ 얼굴 확인 │  │
│                    │  ✓ 조명 확인 │  │
│                    └─────────────┘  │
└──────────────────────────────────────┘
```

### 🎯 웹캠 프리뷰의 목적

1. **얼굴 위치 확인**
   - 얼굴이 화면 중앙에 위치하는지 확인
   - 카메라와 적절한 거리 유지 (40-60cm)

2. **조명 확인**
   - 얼굴이 선명하게 보이는지 확인
   - 너무 어둡거나 밝지 않은지 확인
   - 역광(뒷빛)이 없는지 확인

3. **실시간 피드백**
   - 보정 중 자세 조정 가능
   - 눈동자가 잘 보이는지 확인

### 🎨 UI 구성

#### 웹캠 프리뷰 박스
- **위치:** 화면 오른쪽 하단
- **크기:** 320px × 자동 높이
- **테두리:** 초록색 (3px)
- **배경:** 검정색
- **그림자:** 부드러운 그림자 효과

#### 힌트 메시지
웹캠 영상 위에 반투명 박스로 표시:
```
✓ 얼굴이 화면 중앙에 보이는지 확인하세요
✓ 조명이 충분히 밝은지 확인하세요
```

### 🔧 사용 방법

#### 1. 시선 보정 시작
```html
"시선 보정 시작" 버튼 클릭
↓
시선 보정 오버레이 표시
↓
웹캠 프리뷰 자동 표시 (오른쪽 하단)
```

#### 2. 자세 확인
- 웹캠 프리뷰를 보면서 얼굴 위치 조정
- 얼굴이 중앙에 오도록 조정
- 조명이 얼굴을 밝게 비추도록 조정

#### 3. 보정 진행
- 빨간 점이 나타나면 응시
- 각 점마다 3초간 응시
- 총 9개 점 완료 (5개 위치 × 여러 샘플)

#### 4. 보정 완료
- 자동으로 보정 화면 종료
- 웹캠 프리뷰도 자동으로 사라짐

### 📐 레이아웃 세부사항

#### HTML 구조
```html
<div class="calibration-overlay">
    <div class="calibration-content">
        <h2>시선 보정 중...</h2>
        
        <!-- 웹캠 프리뷰 -->
        <div class="calibration-webcam">
            <img id="calibration-video" src="/video_feed">
            <div class="webcam-hint">
                <p>✓ 얼굴이 화면 중앙에 보이는지 확인하세요</p>
                <p>✓ 조명이 충분히 밝은지 확인하세요</p>
            </div>
        </div>
        
        <!-- 보정 타겟 (빨간 점) -->
        <div class="calibration-target"></div>
        
        <!-- 진행도 바 -->
        <div class="calibration-progress">
            <div class="progress-bar"></div>
        </div>
    </div>
</div>
```

#### CSS 스타일
```css
.calibration-webcam {
    position: fixed;           /* 고정 위치 */
    bottom: 20px;              /* 하단에서 20px */
    right: 20px;               /* 우측에서 20px */
    width: 320px;              /* 너비 320px */
    border-radius: 12px;       /* 둥근 모서리 */
    overflow: hidden;          /* 영상 잘림 방지 */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);  /* 그림자 */
    background: #000;          /* 검정 배경 */
    border: 3px solid #00ff00; /* 초록 테두리 */
    z-index: 1001;             /* 다른 요소 위에 표시 */
}

#calibration-video {
    width: 100%;               /* 너비 100% */
    height: auto;              /* 자동 높이 */
    display: block;            /* 블록 요소 */
}

.webcam-hint {
    position: absolute;        /* 절대 위치 */
    top: 10px;                 /* 상단에서 10px */
    left: 10px;                /* 좌측에서 10px */
    right: 10px;               /* 우측에서 10px */
    background: rgba(0, 0, 0, 0.8);  /* 반투명 검정 */
    padding: 10px;             /* 내부 여백 */
    border-radius: 6px;        /* 둥근 모서리 */
}

.webcam-hint p {
    font-size: 11px;           /* 작은 글씨 */
    color: #00ff00;            /* 초록색 텍스트 */
    margin: 3px 0;             /* 위아래 여백 */
    font-weight: 500;          /* 중간 굵기 */
}
```

### 🎨 디자인 선택 이유

#### 1. 오른쪽 하단 배치
- **장점:**
  - 시선 보정 타겟(빨간 점)을 가리지 않음
  - 보정 진행도 바와 겹치지 않음
  - 직관적인 위치 (부가 정보 영역)

#### 2. 320px 고정 너비
- 너무 크지 않아 시선 보정에 방해되지 않음
- 충분히 커서 얼굴과 조명 상태 확인 가능
- 모바일/태블릿에서도 적절한 크기

#### 3. 초록색 테두리
- 시스템이 정상 작동 중임을 나타냄
- 시선 포인터(초록색)와 일관성
- 긍정적인 피드백 색상

#### 4. 힌트 오버레이
- 사용자에게 확인해야 할 사항 명시
- 반투명 배경으로 영상 가리지 않음
- 간결한 체크리스트 형태

### 🔄 동작 흐름

```
사용자: "시선 보정 시작" 버튼 클릭
    ↓
시스템: calibration-overlay 표시
    ↓
시스템: 웹캠 프리뷰 표시 (오른쪽 하단)
    ↓
사용자: 웹캠 프리뷰 확인
    - 얼굴 위치 조정
    - 조명 확인
    - 자세 조정
    ↓
시스템: 첫 번째 빨간 점 표시
    ↓
사용자: 빨간 점 응시 (3초)
    ↓
시스템: 다음 빨간 점으로 이동
    ↓
... (9개 점 반복)
    ↓
시스템: 보정 완료
    - calibration-overlay 숨김
    - 웹캠 프리뷰 자동 숨김
    ↓
사용자: 메인 화면으로 복귀
    - 메인 화면 웹캠 영상 계속 표시
    - 시선 포인터 활성화
```

### 🐛 문제 해결

#### 웹캠 프리뷰가 보이지 않을 때

1. **브라우저 캐시 삭제**
   ```
   Ctrl+Shift+R (Windows/Linux)
   Cmd+Shift+R (Mac)
   ```

2. **개발자 도구 확인**
   - F12 → Console 탭
   - 에러 메시지 확인
   - `/video_feed` 요청 상태 확인

3. **CSS 로딩 확인**
   - F12 → Network 탭
   - `/static/style.css` 로드 확인 (200 OK)

#### 웹캠 프리뷰가 검은 화면일 때

1. **카메라 권한 확인**
   - 시스템 환경설정 → 보안 및 개인정보보호 → 카메라
   - 브라우저/Python에 권한 부여

2. **카메라 상태 확인**
   - 서버 로그에서 "Camera Status: OPEN" 확인
   - 다른 앱이 카메라 사용 중인지 확인

3. **메인 화면 웹캠 영상 확인**
   - 메인 화면 웹캠이 작동하면 보정 화면도 작동해야 함
   - 같은 `/video_feed` 엔드포인트 사용

### 📱 반응형 디자인

#### 큰 화면 (1920px+)
```
웹캠 프리뷰: 320px × 자동
위치: 오른쪽 하단 (20px 여백)
```

#### 중간 화면 (1024px~1920px)
```
웹캠 프리뷰: 320px × 자동
위치: 오른쪽 하단 (20px 여백)
```

#### 작은 화면 (768px 이하)
```
웹캠 프리뷰: 250px × 자동 (조정 필요)
위치: 오른쪽 하단 (10px 여백)
힌트 텍스트: 더 작은 폰트
```

#### 모바일 (480px 이하)
```
웹캠 프리뷰: 200px × 자동 (조정 필요)
위치: 중앙 하단 (가능성)
힌트 텍스트: 아이콘으로 대체 고려
```

### 🎯 접근성 고려사항

#### 시각장애인
- 웹캠 프리뷰는 보조 기능
- 주요 보정은 시선 추적으로 진행
- 음성 피드백 추가 고려 (향후)

#### 신체장애인
- 웹캠 프리뷰로 자세 확인
- 편안한 자세 유지 가능
- 보정 중 자세 재조정 가능

#### 인지장애인
- 간단한 체크리스트 (2개 항목)
- 시각적 피드백 (초록색 테두리)
- 명확한 지시사항

### 🔮 향후 개선 사항

#### 1. 얼굴 감지 피드백
```javascript
// 얼굴이 감지되면 초록색, 안 되면 빨간색
if (pupils_detected) {
    webcam.style.borderColor = '#00ff00'; // 초록
} else {
    webcam.style.borderColor = '#ff0000'; // 빨강
}
```

#### 2. 조명 경고
```javascript
// 너무 어두우면 경고 표시
if (brightness < 50) {
    showWarning('조명이 너무 어둡습니다');
}
```

#### 3. 거리 가이드
```javascript
// 카메라와의 거리 표시
if (face_size < MIN_SIZE) {
    showHint('카메라에 더 가까이 오세요');
} else if (face_size > MAX_SIZE) {
    showHint('카메라에서 조금 떨어지세요');
}
```

#### 4. 실시간 품질 점수
```
화질: ████████░░ 80%
조명: ██████████ 100%
자세: ███████░░░ 70%
```

### 📝 사용자 테스트 체크리스트

- [ ] 웹캠 프리뷰가 오른쪽 하단에 표시되는가?
- [ ] 웹캠 영상이 실시간으로 업데이트되는가?
- [ ] 힌트 메시지가 읽기 쉬운가?
- [ ] 웹캠 프리뷰가 빨간 점을 가리지 않는가?
- [ ] 보정 완료 후 웹캠 프리뷰가 사라지는가?
- [ ] 웹캠 프리뷰로 얼굴 위치를 조정할 수 있는가?
- [ ] 조명 상태를 확인할 수 있는가?
- [ ] 테두리 색상(초록색)이 눈에 잘 띄는가?

---

## 🎉 완료!

시선 보정 화면에 웹캠 프리뷰가 추가되었습니다!

**테스트 방법:**
1. 서버 재시작: `python3 app.py`
2. 브라우저 새로고침: `http://localhost:8000`
3. "시선 보정 시작" 버튼 클릭
4. **오른쪽 하단에 웹캠 프리뷰 확인** ✅

이제 사용자는 보정 중에 자신의 얼굴 위치와 조명을 실시간으로 확인하면서 최적의 조건으로 보정을 진행할 수 있습니다! 🎯
