# κµ¬ν„ μ™„λ£ μ”μ•½ (2024-10-16)

## π― μ”μ²­μ‚¬ν•­ λ° μ™„λ£ μƒνƒ

### 1. β… μ‹μ„  ν¬μΈν„° μ›Ή ν™”λ©΄ ν‘μ‹
**μ§λ¬Έ:** "ν¬μΈν„°κ°€ μ΄κ² μ›Ήμƒμ—μ„λ„ λ‚μ¤κ² κµ¬ν„μ΄ κ°€λ¥ν•΄?"

**λ‹µλ³€:** μ΄λ―Έ κµ¬ν„λμ–΄ μμµλ‹λ‹¤!
- `gaze-pointer`λ” `video-container` λ‚΄λ¶€μ— μμ–΄μ„ μ›Ή ν™”λ©΄μ— μ‹¤μ‹κ°„ ν‘μ‹λ©λ‹λ‹¤
- μ΄λ΅μƒ‰ μ›ν• ν¬μΈν„° + κ·Έλ¦Όμ ν¨κ³Ό + ν„μ¤ μ• λ‹λ©”μ΄μ…
- WebSocketμ„ ν†µν•΄ μ‹¤μ‹κ°„ μ‹μ„  μ„μΉ μ—…λ°μ΄νΈ

### 2. β… μ›ΉμΊ  μ§€μ† μ‹¤ν–‰
**μ§λ¬Έ:** "μ›ΉμΊ μ„ μ¤‘μ§€ν•λ” κ² ν•„μ”ν•΄? μ›ΉμΊ μ€ κ³„μ† μ‹¤ν–‰λμ–΄μ•Όν•  κ²ƒ κ°™μ•„."

**λ‹µλ³€:** μμ • μ™„λ£!
- μ›ΉμΊ μ€ **ν•­μƒ μ‹¤ν–‰**λ©λ‹λ‹¤
- `/video_feed` μ—”λ“ν¬μΈνΈμ—μ„ μ§€μ†μ μΌλ΅ μ¤νΈλ¦¬λ°
- λ³΄μ • μ „/μ¤‘/ν›„ λ¨λ‘ μ‘λ™
- λ¶ν•„μ”ν• μ›ΉμΊ  μ‹μ‘/μ¤‘μ§€ μ½”λ“ μ κ±°

### 3. β… κ°μΈλ³„ μ‘μ‹ μ‹κ°„ μ΅°μ •
**μ§λ¬Έ:** "μ‹μ„ λ³΄μ •ν• λ• κ°μΈλ³„λ΅ μ–΄λ μ •λ„ μ‹κ°„μ„ ν΄λ¦­μΌλ΅ μΈμ‹ν•λ” μ§€ λ³΄μ •ν•΄μ£Όλ” κ²ƒλ„ μ¶”κ°€ν•΄μ¤¬μΌλ©΄ μΆ‹κ² μ–΄."

**λ‹µλ³€:** κµ¬ν„ μ™„λ£!
- UIμ— μ¬λΌμ΄λ” μ¶”κ°€: **0.3μ΄ ~ 2.0μ΄**
- κΈ°λ³Έκ°’: **0.8μ΄**
- μ‹¤μ‹κ°„ μ΅°μ • κ°€λ¥
- κ°μΈμ— λ§κ² μµμ ν™” κ°€λ¥

### 4. β… λ κΉλΉ΅μ„ ν΄λ¦­ κ°μ§€
**μ§λ¬Έ:** "λμ„ κΉλΉ΅μΌλ• ν΄λ¦­μΌλ΅ μΈμ‹ν•λ” κ²ƒλ„ κµ¬ν„λμ–΄ μλ” μ§€ λ‹¤μ‹ ν™•μΈν•΄μ¤."

**λ‹µλ³€:** μƒλ΅ κµ¬ν„ν–μµλ‹λ‹¤!
- `BlinkClickDetector` ν΄λμ¤ μ¶”κ°€
- μλ„μ  κΉλΉ΅μ„ (0.3~1.0μ΄) κ°μ§€
- ν΄λ¦­ λ°©μ‹ μ„ νƒ UI:
  - **μ‘μ‹ μ‹κ°„ (Dwell)**
  - **λ κΉλΉ΅μ„ (Blink)** β† μƒλ΅ μ¶”κ°€!
  - **λ‘ λ‹¤ μ‚¬μ© (Both)**

---

## π€ μ‚¬μ© λ°©λ²•

### μ„λ²„ μ‹¤ν–‰
```bash
cd edge
python app.py
```

### λΈλΌμ°μ € μ ‘μ†
http://localhost:8000

### UI μ΅°μ‘
1. **ν΄λ¦­ λ°©μ‹ μ„ νƒ** (λ“λ΅­λ‹¤μ΄)
   - μ‘μ‹ μ‹κ°„: μΌμ • μ‹κ°„ μ‘μ‹ β†’ ν΄λ¦­
   - λ κΉλΉ΅μ„: μλ„μ  κΉλΉ΅μ„ β†’ ν΄λ¦­
   - λ‘ λ‹¤ μ‚¬μ©: λ‘ λ°©μ‹ λ¨λ‘

2. **μ‘μ‹ μ‹κ°„ μ΅°μ •** (μ¬λΌμ΄λ”)
   - 0.3~2.0μ΄ λ²”μ„
   - λ³ΈμΈμ—κ² νΈν• μ‹κ°„μΌλ΅ μ΅°μ •

3. **μ‹μ„  λ³΄μ •**
   - "μ‹μ„  λ³΄μ • μ‹μ‘" λ²„νΌ ν΄λ¦­
   - 5κ° λΉ¨κ°„ μ  μ‘μ‹
   - μ›ΉμΊ μ€ κ³„μ† μ‘λ™ (ν•λ‹¨ μμƒ ν‘μ‹)

4. **κΈ°κΈ° μ μ–΄**
   - μ—μ–΄μ»¨ λλ” κ³µκΈ°μ²­μ •κΈ° μ‘μ‹
   - Dwell: μ„¤μ •ν• μ‹κ°„λ§νΌ μ‘μ‹
   - Blink: μ²μ²ν μλ„μ μΌλ΅ κΉλΉ΅μ„

---

## π“ κµ¬ν„ μ„Έλ¶€μ‚¬ν•­

### μƒλ΅ μ¶”κ°€λ ν΄λμ¤

#### `BlinkClickDetector` (tracker.py)
```python
class BlinkClickDetector:
    def __init__(self, blink_duration_min=0.3, blink_duration_max=1.0):
        # 0.3~1.0μ΄ κΉλΉ΅μ„λ§ ν΄λ¦­μΌλ΅ μΈμ‹
        
    def update(self, is_blinking, gaze_position):
        # κΉλΉ΅μ„ μ‹μ‘/μΆ…λ£ κ°μ§€
        # μ§€μ†μ‹κ°„ μ²΄ν¬ β†’ ν΄λ¦­ λ°ν™
```

#### `GazeTracker` μμ •
```python
class GazeTracker:
    def __init__(self, ..., click_mode='dwell'):
        self.dwell_detector = DwellClickDetector(dwell_time)
        self.blink_detector = BlinkClickDetector()
        self.click_mode = click_mode  # 'dwell', 'blink', or 'both'
    
    def update(self, frame):
        # μ„ νƒλ λ°©μ‹μΌλ΅ ν΄λ¦­ κ°μ§€
        # κ²°κ³Όμ— click_method ν¬ν•¨ ('dwell' or 'blink')
```

### μƒλ΅ μ¶”κ°€λ API

#### POST `/api/dwell-time`
```json
{
  "dwell_time": 1.2
}
```
μ‘μ‹ μ‹κ°„ μ΅°μ •

#### POST `/api/click-mode`
```json
{
  "click_mode": "blink"
}
```
ν΄λ¦­ λ°©μ‹ λ³€κ²½: "dwell", "blink", or "both"

### UI μ»΄ν¬λ„νΈ

#### ν΄λ¦­ λ°©μ‹ μ„ νƒ (HTML)
```html
<select id="click-mode-select">
    <option value="dwell">μ‘μ‹ μ‹κ°„ (Dwell)</option>
    <option value="blink">λ κΉλΉ΅μ„ (Blink)</option>
    <option value="both">λ‘ λ‹¤ μ‚¬μ©</option>
</select>
```

#### μ‘μ‹ μ‹κ°„ μ¬λΌμ΄λ” (HTML)
```html
<input type="range" 
       id="dwell-time-slider" 
       min="0.3" 
       max="2.0" 
       step="0.1" 
       value="0.8">
```

---

## β™οΈ ν΄λ¦­ κ°μ§€ λ©”μ»¤λ‹μ¦

### Dwell-time (μ‘μ‹ μ‹κ°„)
1. νΉμ • μ„μΉ μ‘μ‹ μ‹μ‘
2. μ„μΉ λ³€ν™” < 30px μ μ§€
3. μ„¤μ • μ‹κ°„(0.3~2.0μ΄) κ²½κ³Ό
4. β… ν΄λ¦­ λ°μƒ

**νΉμ§•:**
- μ •ν™•ν•κ³  μ•μ •μ 
- μ§„ν–‰λ„ μ‹κ°ν™” (νλ€ μ›ν• λ°”)
- μλ„ν•μ§€ μ•μ€ ν΄λ¦­ λ°©μ§€

### Blink (λ κΉλΉ΅μ„)
1. μ‘μ‹ μ„μΉ μ €μ¥
2. κΉλΉ΅μ„ μ‹μ‘ κ°μ§€
3. κΉλΉ΅μ„ μΆ…λ£ κ°μ§€
4. μ§€μ†μ‹κ°„ 0.3~1.0μ΄ μ²΄ν¬
5. β… ν΄λ¦­ λ°μƒ (μ €μ¥λ μ„μΉμ—μ„)

**νΉμ§•:**
- λΉ λ¥Έ λ°μ‘ μ†λ„
- μμ—°μ¤λ¬μ΄ μΈν„°λ™μ…
- 0.3μ΄ λ―Έλ§: μΌλ° κΉλΉ΅μ„ (λ¬΄μ‹)
- 1.0μ΄ μ΄κ³Ό: λ„λ¬΄ κΈ΄ κΉλΉ΅μ„ (λ¬΄μ‹)

### Both (λ‘ λ‹¤)
- λ‘ λ°©μ‹ λ™μ‹ ν™μ„±ν™”
- λ¨Όμ € κ°μ§€λ λ°©μ‹μΌλ΅ ν΄λ¦­
- μ‚¬μ©μκ°€ νΈν• λ°©μ‹ μ„ νƒ κ°€λ¥

---

## π¨ μ‹κ°μ  ν”Όλ“λ°±

### μ‹μ„  ν¬μΈν„°
- **μ„μΉ:** μ›ΉμΊ  μμƒ μ„
- **μƒ‰μƒ:** μ΄λ΅μƒ‰ (rgba(0, 255, 0))
- **ν¨κ³Ό:** κ·Έλ¦Όμ + ν„μ¤ μ• λ‹λ©”μ΄μ…
- **z-index:** 100 (ν•­μƒ μµμƒμ„)

### Dwell μ§„ν–‰λ„
- **μ„μΉ:** μ‘μ‹ μ§€μ 
- **λ¨μ–‘:** νλ€μƒ‰ μ›ν• μ§„ν–‰ λ°”
- **μ• λ‹λ©”μ΄μ…:** νμ „ (spin)

### ν΄λ¦­ ν”Όλ“λ°±
- ν¬μΈν„° μƒ‰μƒ λ³€ν™”: μ΄λ΅ β†’ λΉ¨κ°• β†’ μ΄λ΅
- κΈ°κΈ° μΉ΄λ“ ν™•λ€ + κ·Έλ¦Όμ
- 0.5μ΄ ν›„ μ›λλ€λ΅

---

## π“ ν…μ¤νΈ λ°μ΄ν„°

### Mock κΈ°κΈ° (2κ°)
1. **μ—μ–΄μ»¨** (ac_living_room)
   - μ¨λ„: 24Β°C
   - ν’λ‰: μ¤‘κ°„
   - ν† κΈ€ κ°€λ¥

2. **κ³µκΈ°μ²­μ •κΈ°** (air_purifier_living_room)
   - ν’λ‰: μ•½
   - ν† κΈ€ κ°€λ¥

---

## π”§ μ£Όμ” νμΌ λ³€κ²½μ‚¬ν•­

### 1. `edge/gaze/tracker.py`
- β… `BlinkClickDetector` ν΄λμ¤ μ¶”κ°€
- β… `GazeTracker`: `click_mode` νλΌλ―Έν„° μ¶”κ°€
- β… `update()`: λ‘ κ°€μ§€ ν΄λ¦­ λ°©μ‹ μ§€μ›
- β… κ²°κ³Όμ— `click_method` ν•„λ“ μ¶”κ°€

### 2. `edge/app.py`
- β… `POST /api/dwell-time` API μ¶”κ°€
- β… `POST /api/click-mode` API μ¶”κ°€

### 3. `edge/templates/index.html`
- β… ν΄λ¦­ λ°©μ‹ μ„ νƒ λ“λ΅­λ‹¤μ΄
- β… μ‘μ‹ μ‹κ°„ μ¬λΌμ΄λ”
- β… λ¶ν•„μ”ν• μ›ΉμΊ  div μ κ±°

### 4. `edge/static/style.css`
- β… `.click-mode-setting` μ¤νƒ€μΌ
- β… `.dwell-time-setting` μ¤νƒ€μΌ
- β… Select box μ¤νƒ€μΌλ§

### 5. `edge/static/app.js`
- β… `updateClickMode()` ν•¨μ
- β… `updateDwellTime()` ν•¨μ
- β… μ›ΉμΊ  μ‹μ‘/μ¤‘μ§€ ν•¨μ μ κ±°
- β… μ΄λ²¤νΈ λ¦¬μ¤λ„ μ¶”κ°€

---

## β¨ ν•µμ‹¬ κ°μ„ μ‚¬ν•­

1. **μ›ΉμΊ  ν•­μƒ μ‹¤ν–‰** - λ³΄μ • μ „/μ¤‘/ν›„ μ§€μ† μ¤νΈλ¦¬λ°
2. **μ‹μ„  ν¬μΈν„°** - μ›Ή ν™”λ©΄μ— μ‹¤μ‹κ°„ ν‘μ‹
3. **κ°μΈ λ§μ¶¤** - μ‘μ‹ μ‹κ°„ 0.3~2.0μ΄ μ΅°μ •
4. **λ κΉλΉ΅μ„ ν΄λ¦­** - μƒλ΅μ΄ μΈν„°λ™μ… λ°©μ‹ μ¶”κ°€
5. **ν΄λ¦­ λ°©μ‹ μ„ νƒ** - Dwell / Blink / Both μ¤‘ μ„ νƒ

λ¨λ“  μ”μ²­μ‚¬ν•­μ΄ μ™„λ£λμ—μµλ‹λ‹¤! π‰
